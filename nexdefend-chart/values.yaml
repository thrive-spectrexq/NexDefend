# Default values for nexdefend-chart.

replicaCount: 1

image:
  pullPolicy: IfNotPresent
  tag: "latest" # In production, replace this with a specific version (e.g., v1.0.0)

serviceAccount:
  create: true
  annotations: {}
  name: ""

# -- Global Security Context (Applied to all pods)
podSecurityContext:
  fsGroup: 2000

# -- Container Security Context (Matches our new non-root Dockerfiles)
securityContext:
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000 # Matches the UID of 'appuser' usually created in Alpine

# ==============================================================================
# Service Configurations
# ==============================================================================

api:
  name: nexdefend-api
  image:
    repository: your-registry/nexdefend-api
  service:
    type: ClusterIP
    port: 8080
  environment:
    PYTHON_API: "http://nexdefend-ai:5000"
    # In K8s, CORS should point to the Ingress host, not localhost
    CORS_ALLOWED_ORIGINS: "https://nexdefend.yourdomain.com"
    OTEL_EXPORTER_OTLP_ENDPOINT: "http://otel-collector:4317"
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  probes:
    enabled: true

ai:
  name: nexdefend-ai
  image:
    repository: your-registry/nexdefend-ai
  service:
    type: ClusterIP
    port: 5000
  environment:
    GO_API_URL: "http://nexdefend-api:8080/api/v1"
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 200m
      memory: 256Mi

soar:
  name: nexdefend-soar
  image:
    repository: your-registry/nexdefend-soar
  service:
    type: ClusterIP
    port: 8080 # Container listens on 8080
  environment:
    KAFKA_BROKER: "nexdefend-kafka:9092"
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi

cloudConnector:
  name: nexdefend-cloud-connector
  image:
    repository: your-registry/nexdefend-cloud-connector
  # No service/ports needed as it is a consumer
  environment:
    KAFKA_BROKER: "nexdefend-kafka:9092"
  resources:
    limits:
      cpu: 200m
      memory: 256Mi

frontend:
  name: nexdefend-frontend
  image:
    repository: your-registry/nexdefend-frontend
  service:
    type: ClusterIP
    port: 80 # Production builds usually serve on 80
  ingress:
    enabled: false
    className: "nginx"
    hosts:
      - host: nexdefend.local
        paths:
          - path: /
            pathType: ImplementationSpecific

# ==============================================================================
# External / Sub-chart Configuration
# ==============================================================================

# Enable sub-charts
postgresql:
  enabled: true
  auth:
    username: nexdefend
    database: nexdefend_db
    # password: set via --set postgresql.auth.password during install

kafka:
  enabled: true
  provisioning:
    enabled: true
    topics:
      - name: incidents
        partitions: 1
        replicationFactor: 1

# Configuration mapped into the ConfigMap
config:
  dbHost: "nexdefend-postgresql" # Points to the sub-chart service
  dbPort: "5432"
